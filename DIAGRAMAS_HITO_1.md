# ğŸ—‚ï¸ ESTRUCTURA Y DIAGRAMAS - PRESERV-RAG HITO 1

## Estructura de Carpetas

```
preserv-rag/
â”‚
â”œâ”€â”€ ğŸ“ data/
â”‚   â”œâ”€â”€ pdfs/                          # ğŸ“„ Input: Tus 20 PDFs aquÃ­
â”‚   â”‚   â”œâ”€â”€ FTB-61-212.pdf
â”‚   â”‚   â”œâ”€â”€ paper-2.pdf
â”‚   â”‚   â””â”€â”€ ... (20 PDFs totales)
â”‚   â”‚
â”‚   â””â”€â”€ chroma_db/                     # ğŸ—„ï¸ Output: BD Vectorial (creada)
â”‚       â”œâ”€â”€ chroma.parquet
â”‚       â”œâ”€â”€ index/
â”‚       â””â”€â”€ metadata/
â”‚
â”œâ”€â”€ ğŸ“ src/                             # ğŸ”§ MÃ³dulos principales
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ data_ingestion.py              # ğŸ“¥ Lee PDFs â†’ Documentos
â”‚   â”œâ”€â”€ text_extraction.py             # ğŸ§¹ Limpia texto
â”‚   â”œâ”€â”€ chunking.py                    # âœ‚ï¸ Divide en chunks
â”‚   â”œâ”€â”€ metadata_extraction.py         # ğŸ·ï¸ Extrae pH, aW, etc
â”‚   â”œâ”€â”€ vector_db.py                   # ğŸ—„ï¸ BD Vectorial (Chroma)
â”‚   â”œâ”€â”€ retriever.py                   # ğŸ” BÃºsqueda vectorial
â”‚   â””â”€â”€ benchmark.py                   # ğŸ“Š MÃ©tricas
â”‚
â”œâ”€â”€ ğŸ“„ streamlit_app.py                 # ğŸ–¥ï¸ Interfaz principal
â”œâ”€â”€ â–¶ï¸ run_pipeline.py                  # â–¶ï¸ Script automÃ¡tico
â”œâ”€â”€ ğŸ“š examples.py                      # ğŸ“– 6 ejemplos de uso
â”œâ”€â”€ ğŸ“‹ requirements.txt                 # ğŸ“¦ Dependencias
â”œâ”€â”€ ğŸ“– README.md                        # ğŸ“– DocumentaciÃ³n completa
â”œâ”€â”€ âš¡ QUICK_START.md                  # âš¡ Inicio rÃ¡pido (5 min)
â””â”€â”€ ğŸ“‹ RESUMEN_HITO_1.md               # ğŸ“‹ Este archivo

```

---

## Pipeline de Datos (Flujo Principal)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  20 PDFs Localesâ”‚
                    â”‚  (data/pdfs/)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  PDFIngestion        â”‚
                    â”‚  (PyPDF2)            â”‚
                    â”‚ â€¢ Lee PDF            â”‚
                    â”‚ â€¢ Extrae texto       â”‚
                    â”‚ â€¢ Metadata PDF       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  TextExtractor       â”‚
                    â”‚  (regex + limpieza)  â”‚
                    â”‚ â€¢ Elimina espacios   â”‚
                    â”‚ â€¢ Quita caracteres   â”‚
                    â”‚ â€¢ Normaliza          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  DocumentChunker         â”‚
                    â”‚  (500 chars + overlap)   â”‚
                    â”‚ â€¢ Divide en chunks       â”‚
                    â”‚ â€¢ Solapamiento: 50 chars â”‚
                    â”‚ â€¢ Preserva contexto      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  MetadataExtractor               â”‚
                    â”‚  (regex + pattern matching)      â”‚
                    â”‚ â€¢ Extrae pH (3.5-5.0)            â”‚
                    â”‚ â€¢ Extrae aW (0.85-0.99)          â”‚
                    â”‚ â€¢ Microorganismos                â”‚
                    â”‚ â€¢ Conservantes                   â”‚
                    â”‚ â€¢ Concentraciones (ppm, mg/kg)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  VectorDatabase (Chroma)         â”‚
                    â”‚  + SentenceTransformers          â”‚
                    â”‚ â€¢ Embeddings (384-dim)           â”‚
                    â”‚ â€¢ IndexaciÃ³n cosine              â”‚
                    â”‚ â€¢ Persistencia local              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Chroma Vector Database    â”‚
                    â”‚ (data/chroma_db/)         â”‚
                    â”‚ â€¢ 2000-3000 chunks        â”‚
                    â”‚ â€¢ Con metadata indexado   â”‚
                    â”‚ â€¢ Pronto para bÃºsqueda    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                â”‚                â”‚
      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
      â”‚ Retriever â”‚    â”‚ Benchmark â”‚   â”‚ Streamlit  â”‚
      â”‚ (bÃºsqueda)â”‚    â”‚ (mÃ©tricas)â”‚   â”‚ (UI)       â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Arquitectura por Capas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸ–¥ï¸ INTERFAZ DE USUARIO                         â”‚
â”‚              Streamlit App (4 tabs)                          â”‚
â”‚  Pipeline | BÃºsqueda | MÃ©tricas | InformaciÃ³n              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
             â”‚                                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”
â”‚           ğŸ“Š CAPA DE EVALUACIÃ“N                              â”‚
â”‚           RAGBenchmark                                       â”‚
â”‚  â€¢ Precision@K  â€¢ Recall@K  â€¢ MRR  â€¢ NDCG                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
             â”‚                                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”
â”‚           ğŸ” CAPA DE RECUPERACIÃ“N                            â”‚
â”‚           SimpleRetriever                                    â”‚
â”‚  â€¢ BÃºsqueda vectorial  â€¢ Filtros  â€¢ Thresholds             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
             â”‚                                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”
â”‚           ğŸ—„ï¸ CAPA DE ALMACENAMIENTO VECTORIAL              â”‚
â”‚           VectorDatabase (Chroma)                            â”‚
â”‚  â€¢ Embeddings (sentence-transformers)                       â”‚
â”‚  â€¢ BÃºsqueda cosine  â€¢ Persistencia                          â”‚
â”‚  â€¢ IndexaciÃ³n con metadata                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
             â”‚                                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”
â”‚           ğŸ”§ CAPA DE PROCESAMIENTO                           â”‚
â”‚  â€¢ Chunking  â€¢ Metadata Extraction  â€¢ Text Cleaning        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
             â”‚                                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”
â”‚           ğŸ“¥ CAPA DE INGESTA                                â”‚
â”‚           PDFIngestion (PyPDF2)                              â”‚
â”‚           Lee 20 PDFs desde data/pdfs/                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo de Consulta (Query to Results)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario en Streamlit     â”‚
â”‚ "Â¿QuÃ© alternativa a      â”‚
â”‚  benzoato para pH 4.2?"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Query Preprocessing              â”‚
â”‚ "benzoato alternativa pH 4.2"    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SentenceTransformer             â”‚
â”‚ Generar embedding de query      â”‚
â”‚ (384-dimensional vector)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chroma Vector Database          â”‚
â”‚ BÃºsqueda cosine similarity      â”‚
â”‚ Encontrar top-5 chunks similares â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Retriever.retrieve()            â”‚
â”‚ Retornar:                        â”‚
â”‚ â€¢ ID del chunk                  â”‚
â”‚ â€¢ Contenido                     â”‚
â”‚ â€¢ Similitud (0.0-1.0)          â”‚
â”‚ â€¢ Metadata (fuente, pH, etc)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Formatear Resultados            â”‚
â”‚ En Streamlit (UI)               â”‚
â”‚ â€¢ Top-5 resultados              â”‚
â”‚ â€¢ Puntuaciones                  â”‚
â”‚ â€¢ Metadata                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## MÃ³dulos y Sus Responsabilidades

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ data_ingestion.py                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ PDFIngestion class                                        â”‚
â”‚ â€¢ load_pdfs(): Lee PDFs de carpeta                         â”‚
â”‚ â€¢ _read_pdf(): Parsea individual PDF                       â”‚
â”‚ â€¢ get_stats(): Retorna estadÃ­sticas                        â”‚
â”‚ Entrada: data/pdfs/                                        â”‚
â”‚ Salida: List[Dict] con contenido y metadata                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ text_extraction.py                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ TextExtractor class                                       â”‚
â”‚ â€¢ clean_text(): Limpia y normaliza                         â”‚
â”‚ â€¢ extract_references(): Extrae citas                        â”‚
â”‚ â€¢ process_documents(): Procesa lista                        â”‚
â”‚ Entrada: Documentos sin procesar                            â”‚
â”‚ Salida: Documentos limpios (15-20% reducciÃ³n)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ chunking.py                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ DocumentChunker class                                     â”‚
â”‚ â€¢ chunk_text(): Divide un texto                            â”‚
â”‚ â€¢ chunk_documents(): Procesa lista de docs                 â”‚
â”‚ â€¢ get_stats(): EstadÃ­sticas de chunks                      â”‚
â”‚ Entrada: Documentos limpios                                â”‚
â”‚ Salida: 2000-3000 chunks con metadata origen               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ metadata_extraction.py                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ MetadataExtractor class                                   â”‚
â”‚ â€¢ extract_ph_range(): Extrae pH                            â”‚
â”‚ â€¢ extract_aw(): Extrae aW                                  â”‚
â”‚ â€¢ extract_microorganism(): Identifica microorganismos       â”‚
â”‚ â€¢ extract_chunk_metadata(): Todo en uno                    â”‚
â”‚ Entrada: Chunks de texto                                   â”‚
â”‚ Salida: Chunks con metadata extraÃ­da                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ vector_db.py                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ VectorDatabase class (Chroma)                             â”‚
â”‚ â€¢ add_chunks(): Indexa chunks con embeddings               â”‚
â”‚ â€¢ search(): BÃºsqueda por similitud                         â”‚
â”‚ â€¢ get_collection_stats(): EstadÃ­sticas                     â”‚
â”‚ Entrada: Chunks con metadata                               â”‚
â”‚ Salida: BD indexada en data/chroma_db/                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ retriever.py                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ SimpleRetriever class                                     â”‚
â”‚ â€¢ retrieve(): BÃºsqueda vectorial bÃ¡sica                    â”‚
â”‚ â€¢ retrieve_with_threshold(): Con umbral                    â”‚
â”‚ â€¢ retrieve_by_source(): Por archivo fuente                 â”‚
â”‚ Entrada: BD vectorial + query                              â”‚
â”‚ Salida: Top-K chunks similares                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ benchmark.py                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ RAGBenchmark class                                        â”‚
â”‚ â€¢ evaluate_query(): EvalÃºa una consulta                    â”‚
â”‚ â€¢ evaluate_multiple_queries(): Batch evaluation             â”‚
â”‚ â€¢ calculate_precision_at_k(), recall_at_k(), etc.         â”‚
â”‚ Entrada: Retriever + queries con relevancia ground truth   â”‚
â”‚ Salida: MÃ©tricas (P@K, R@K, MRR, NDCG)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo de EjecuciÃ³n Streamlit

```
Inicio: streamlit run streamlit_app.py
   â”‚
   â”œâ”€â–¶ Carga Sidebar (configuraciÃ³n)
   â”‚   â€¢ chunk_size
   â”‚   â€¢ overlap
   â”‚   â€¢ n_results
   â”‚   â€¢ similarity_threshold
   â”‚
   â””â”€â–¶ Tabs (4 pestaÃ±as)
       â”‚
       â”œâ”€ TAB 1: PIPELINE
       â”‚  â”œâ”€ Cargar PDFs â”€â”€â”€â–¶ PDFIngestion.load_pdfs()
       â”‚  â”œâ”€ Limpiar Texto â”€â”€â–¶ TextExtractor.process_documents()
       â”‚  â”œâ”€ Chunking â”€â”€â”€â”€â”€â”€â–¶ DocumentChunker.chunk_documents()
       â”‚  â”œâ”€ Metadata â”€â”€â”€â”€â”€â”€â–¶ MetadataExtractor.process_chunks()
       â”‚  â””â”€ Vectorizar â”€â”€â”€â”€â–¶ VectorDatabase.add_chunks()
       â”‚
       â”œâ”€ TAB 2: BÃšSQUEDA
       â”‚  â”œâ”€ Input: Query (texto)
       â”‚  â”œâ”€ SimpleRetriever.retrieve(query, n_results)
       â”‚  â””â”€ Output: Top-5 chunks con similitud
       â”‚
       â”œâ”€ TAB 3: MÃ‰TRICAS
       â”‚  â”œâ”€ Mostrar estadÃ­sticas BD
       â”‚  â”œâ”€ Agregar queries de prueba
       â”‚  â”œâ”€ RAGBenchmark.evaluate_multiple_queries()
       â”‚  â””â”€ Mostrar: P@5, R@5, MRR, NDCG@5
       â”‚
       â””â”€ TAB 4: INFORMACIÃ“N
          â”œâ”€ Arquitectura del pipeline
          â”œâ”€ Componentes
          â”œâ”€ TecnologÃ­as
          â””â”€ Flujo de uso
```

---

## Metadata ExtraÃ­da por Chunk

```
{
  "id": "FTB-61-212_chunk_0",
  "content": "texto del chunk...",
  "source_file": "FTB-61-212.pdf",
  "doc_title": "Essential Oil and Plant Extracts...",
  "extracted_metadata": {
    "ph": {
      "ph_min": 4.0,
      "ph_max": 4.5
    },
    "aw": {
      "aw_min": 0.95,
      "aw_max": 0.98
    },
    "microorganisms": [
      "Zygosaccharomyces bailii",
      "Pseudomonas"
    ],
    "conservants": [
      "benzoato",
      "extracto de clavo"
    ],
    "concentration": {
      "concentration_value": 500,
      "concentration_unit": "ppm"
    },
    "has_numeric_data": true
  }
}
```

---

## Espacio Vectorial (Embeddings)

```
Texto Original:
"El extracto de clavo a 500 ppm inhibiÃ³ completamente 
 Zygosaccharomyces bailii a pH 4.0 y aW 0.97"

        â”‚
        â–¼ (SentenceTransformer: all-MiniLM-L6-v2)
        
Embedding (vector de 384 dimensiones):
[0.12, -0.45, 0.78, ..., 0.23]  â† 384 nÃºmeros reales
        â”‚
        â–¼ (Almacenar en Chroma)
        
BÃºsqueda (cosine similarity):
Query: "alternativa benzoato"
Embedding: [0.14, -0.42, 0.81, ..., 0.25]
        â”‚
        â–¼
Similaridad = cos(Ã¡ngulo) = 0.87  â† Entre 0 y 1
```

---

## EstadÃ­sticas Esperadas

```
â”Œâ”€ INGESTA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ PDFs cargados: 20                         â”‚
â”‚ â€¢ PÃ¡ginas totales: ~250                     â”‚
â”‚ â€¢ Caracteres: ~1,500,000                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ LIMPIEZA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ ReducciÃ³n: 15-20%                         â”‚
â”‚ â€¢ Caracteres eliminados: ~250,000           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ CHUNKING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Chunks totales: 2,000-3,000               â”‚
â”‚ â€¢ TamaÃ±o promedio: 450 caracteres           â”‚
â”‚ â€¢ Chunks por PDF: ~130                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ METADATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Con pH: ~400 chunks (20%)                 â”‚
â”‚ â€¢ Con aW: ~350 chunks (17%)                 â”‚
â”‚ â€¢ Con microorganismos: ~600 (30%)           â”‚
â”‚ â€¢ Con conservantes: ~550 (27%)              â”‚
â”‚ â€¢ Cobertura total: ~35%                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ BENCHMARK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Precision@5: 0.60-0.80                    â”‚
â”‚ â€¢ Recall@5: 0.40-0.60                       â”‚
â”‚ â€¢ MRR: 0.50-0.70                            â”‚
â”‚ â€¢ NDCG@5: 0.55-0.75                         â”‚
â”‚ â€¢ Similitud promedio: 0.35-0.50             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ComparaciÃ³n: Antes vs DespuÃ©s del Hito 1

```
ANTES (Sin el sistema):
â”œâ”€ âŒ 20 PDFs dispersos sin indexar
â”œâ”€ âŒ No hay bÃºsqueda
â”œâ”€ âŒ No hay recomendaciones automÃ¡ticas
â”œâ”€ âŒ Consultas manuales toman horas
â””â”€ âŒ Sin mÃ©tricas de calidad

DESPUÃ‰S (Con Preserv-RAG Hito 1):
â”œâ”€ âœ… 20 PDFs indexados en base vectorial
â”œâ”€ âœ… BÃºsqueda en milisegundos
â”œâ”€ âœ… Recomendaciones basadas en metadata (pH, aW)
â”œâ”€ âœ… Respuestas en segundos
â”œâ”€ âœ… MÃ©tricas de evaluaciÃ³n (P@K, R@K, MRR, NDCG)
â””â”€ âœ… Interfaz grÃ¡fica intuitiva
```

---

**Diagrama creado para Preserv-RAG Hito 1**
**VersiÃ³n: 1.0 - Noviembre 2024**
